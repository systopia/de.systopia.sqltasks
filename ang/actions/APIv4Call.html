<div class="crm-accordion-wrapper crm-sqltask-apiv4 relativePosition collapsed">
    <div class="crm-accordion-header active accordion-header-custom action-label">
        <label class="input-checkbox">
            <input
                ng-false-value="'0'"
                ng-true-value="'1'"
                ng-model="model['enabled']"
                style="cursor: pointer;"
                type="checkbox"
            />

            &nbsp;{{ts('APIv4 Call')}}
        </label>

        <span ng-if="model['action_title']" class="sql-task-action-title">
            {{model['action_title']}}
        </span>

        <label class="header-delete-btn" ng-click="removeItemFromArray(index)">
            <i class="crm-i fa-trash header-delete"></i>
            {{ts('Delete')}}
        </label>
    </div>

    <div class="crm-accordion-body" style="display: none;">
        <div class="sql-task-action-template-wrapper">
            <action-template-select
                model='model'
                action-templates='actionTemplates'
                action-template='actionTemplate'>
            </action-template-select>

            <div class="clear"></div>

            <action-template-form
                model='model'
                action-templates='actionTemplates'
                action-template='actionTemplate'>
            </action-template-form>
        </div>

        <div class="sql-tasks">
            <action-additional-info
                model='model'
                fieldPrefix="'apiv4_call'"
                index='index'
            ></action-additional-info>

            <text-input
                class="explorer-url"
                fieldid="'apiv4_url' + index"
                fieldlabel="ts('APIv4 Explorer URL')"
                helpaction="onInfoPress('APIv4 Explorer URL', 'id-apiv4-explorer-url', 'CRM/Sqltasks/Action/APIv4Call')"
                input-change="onUrlInput(value)"
                inputMaxWidth="'600px'"
                isrequired="false"
                model="model['url']"
                showHelpIcon="true"
            ></text-input>

            <hr style="margin-bottom:1em;" />

            <text-input
                fieldid="'apiv4_table' + index"
                fieldlabel="ts('Data Table')"
                helpaction="onInfoPress('Data Table', 'id-apiv4-datatable', 'CRM/Sqltasks/Action/APIv4Call')"
                inputMaxWidth="'500px'"
                isrequired="getBooleanFromNumber(model['enabled'])"
                model="model['table']"
                showHelpIcon="true"
                sizelength="60"
            ></text-input>

            <ordinary-select2
                fieldid="'apiv4_entity' + index"
                fieldlabel="ts('Entity')"
                helpaction="onInfoPress('Entity', 'id-apiv4-entity', 'CRM/Sqltasks/Action/APIv4Call')"
                isrequired="getBooleanFromNumber(model['enabled'])"
                model="model['entity']"
                optionsArray="apiv4Entities"
                select-change="onEntitySelection(value)"
                showHelpIcon="true"
            ></ordinary-select2>

            <ordinary-select2
                fieldid="'apiv4_action' + index"
                fieldlabel="ts('Action')"
                helpaction="onInfoPress('Action', 'id-apiv4-action', 'CRM/Sqltasks/Action/APIv4Call')"
                isrequired="getBooleanFromNumber(model['enabled'])"
                model="model['action']"
                optionsArray="apiv4EntityActions"
                select-change="onActionSelection(value)"
                showHelpIcon="true"
            ></ordinary-select2>

            <ordinary-select2
                fieldid="'apiv4_handle_api_errors' + index"
                fieldlabel="ts('Error Handling')"
                helpaction="onInfoPress('Error Handling', 'id-apiv4-handle-api-errors', 'CRM/Sqltasks/Action/APIv4Call')"
                isrequired="getBooleanFromNumber(model['enabled'])"
                model="model['handle_api_errors']"
                optionsArray="apiv4ErrorHandlerOptions"
                showHelpIcon="true"
            ></ordinary-select2>

            <check-box
                fieldid="'apiv4_store_results' + index"
                fieldlabel="ts('Store API results')"
                helpaction="onInfoPress('Store API results', 'id-apiv4-store-results', 'CRM/Sqltasks/Action/APIv4Call')"
                model="model['store_api_results']"
                showHelpIcon="true"
            ></check-box>

            <text-area
                fieldid="'apiv4_parameters' + index"
                fieldlabel="ts('Parameters')"
                helpaction="onInfoPress('Parameters', 'id-apiv4-parameters', 'CRM/Sqltasks/Action/APIv4Call')"
                input-change="onParamsChange(value)"
                inputMaxWidth="'500px'"
                isrequired="false"
                model="model['parameters']"
                rowsnumber="8"
                showHelpIcon="true"
            ></text-area>
        </div>
    </div>
</div>
